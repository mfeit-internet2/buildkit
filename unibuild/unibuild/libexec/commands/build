#!/bin/sh -e
#
# build - Do the default build.
#

. "$(dirname $0)/../common"

help()
{
    cat <<EOF
Usage: ${WHOAMI} [ OPTIONS ]

OPTIONS:

  --start P  Start with package P
  --stop P   Stop after package P
  --release  Do a release build, without timestamp

EOF
}

START=
START_PACKAGE=
STOP=
STOP_PACKAGE=
export TIMESTAMP=$(date +%Y%m%d%H%M%S)

while [ "$1" ]
do
    case "$1" in

	--release)
	    unset TIMESTAMP
	    shift
	    ;;

	--start)
	    START=$2
	    START_OPTION="--start $2"
	    shift
	    shift
	    ;;

	--stop)
	    STOP=$2
	    STOP_OPTION="--stop $2"
	    shift
	    shift
	    ;;

	--help)
	    help
	    exit 0
	    ;;

	--*)
	    die "Unknown option '$1'"
	    ;;

	*)
	    break
	    ;;
    esac
done



# Don't quote START; it has multiple words.
$(dirname $0)/make ${START_OPTION} ${STOP_OPTION} clean build install

REPO=unibuild-repo
mkdir -p "${REPO}"
exec $(dirname $0)/gather --start "${START}" --stop "${STOP}" "${REPO}"
